<!--pages/dish-detail/dish-detail.wxml-->
<view class="container" wx:if="{{!loading && dish}}">
  <!-- èœå“å›¾ç‰‡ -->
  <view class="dish-image-section">
    <image class="dish-image" src="{{getImageUrl(dish.image)}}" mode="aspectFill" bindtap="onPreviewImage" data-url="{{getImageUrl(dish.image)}}"></image>
    
    <!-- æ”¶è—æŒ‰é’®æµ®åŠ¨åœ¨å›¾ç‰‡ä¸Š -->
    <view class="favorite-btn" bindtap="onToggleFavorite">
      <text class="heart-icon {{isFavorite ? 'favorited' : ''}}">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
    </view>
    
    <view class="image-overlay">
      <view class="dish-title">{{dish.name}}</view>
      <view class="dish-meta">
        <text class="dish-category">{{dish.categoryName}}</text>
        <text class="dish-time">{{formatRelativeTime(dish.createTime)}}</text>
      </view>
    </view>
  </view>

  <!-- èœå“ä¿¡æ¯ -->
  <view class="dish-info-section card">
    <view class="info-row">
      <view class="info-item">
        <text class="info-label">éš¾åº¦</text>
        <text class="info-value" style="color: {{getDifficultyColor(dish.difficulty)}}">{{getDifficultyText(dish.difficulty)}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">æ—¶é—´</text>
        <text class="info-value">{{dish.cookingTime}}åˆ†é’Ÿ</text>
      </view>
      <view class="info-item">
        <text class="info-label">ä»½æ•°</text>
        <text class="info-value">{{dish.servings || 1}}äººä»½</text>
      </view>
      <view class="info-item" wx:if="{{dish.calories}}">
        <text class="info-label">çƒ­é‡</text>
        <text class="info-value">{{dish.calories}}å¡</text>
      </view>
    </view>
    
    <view class="stats-row">
      <view class="stat-item">
        <text class="stat-icon">ğŸ‘ï¸</text>
        <text class="stat-text">{{dish.viewCount || 0}}æ¬¡æµè§ˆ</text>
      </view>
      <view class="stat-item">
        <text class="stat-icon">â¤ï¸</text>
        <text class="stat-text">{{dish.collectCount || 0}}æ¬¡æ”¶è—</text>
      </view>
    </view>
  </view>

  <!-- èœå“æè¿° -->
  <view class="description-section card" wx:if="{{dish.description}}">
    <view class="section-title">èœå“ä»‹ç»</view>
    <text class="description-text">{{dish.description}}</text>
  </view>

  <!-- é£Ÿææ¸…å• -->
  <view class="ingredients-section card" wx:if="{{ingredients.length > 0}}">
    <view class="section-title">é£Ÿææ¸…å•</view>
    <view class="ingredients-list">
      <view class="ingredient-item" wx:for="{{ingredients}}" wx:key="id">
        <text class="ingredient-name">{{item.name}}</text>
        <text class="ingredient-amount">{{item.amount}}{{item.unit}}</text>
      </view>
    </view>
  </view>

  <!-- åˆ¶ä½œæ­¥éª¤é¢„è§ˆ -->
  <view class="steps-preview-section card" wx:if="{{steps.length > 0}}">
    <view class="section-title">åˆ¶ä½œæ­¥éª¤ ({{steps.length}}æ­¥)</view>
    <view class="steps-preview-list">
      <view class="step-preview-item" wx:for="{{steps}}" wx:key="id" wx:for-index="index">
        <view class="step-number">{{index + 1}}</view>
        <view class="step-content">
          <image class="step-image" src="{{getImageUrl(item.image)}}" mode="aspectFill" wx:if="{{item.image}}" bindtap="onPreviewImage" data-url="{{getImageUrl(item.image)}}"></image>
          <text class="step-description">{{item.description}}</text>
          <view class="step-meta" wx:if="{{item.duration || item.temperature}}">
            <text class="step-duration" wx:if="{{item.duration}}">â± {{item.duration}}åˆ†é’Ÿ</text>
            <text class="step-temperature" wx:if="{{item.temperature}}">ğŸŒ¡ {{item.temperature}}Â°C</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn favorite-action {{isFavorite ? 'favorited' : ''}}" bindtap="onToggleFavorite">
      <text class="heart-icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
      <text class="btn-text">{{isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
    </button>
    <button class="action-btn primary" bindtap="onStartCooking" wx:if="{{steps.length > 0}}">
      <text class="btn-text">å¼€å§‹åˆ¶ä½œ</text>
    </button>
    <button class="action-btn secondary" open-type="share">
      <text class="btn-text">åˆ†äº«èœè°±</text>
    </button>
  </view>
</view>

<!-- åˆ¶ä½œæ­¥éª¤å¼¹çª— -->
<view class="steps-modal" wx:if="{{showSteps}}" catchtouchmove="true">
  <view class="steps-modal-content">
    <view class="steps-header">
      <text class="steps-title">åˆ¶ä½œæ­¥éª¤</text>
      <text class="steps-progress">{{currentStepIndex + 1}}/{{steps.length}}</text>
      <text class="close-btn" bindtap="onCloseSteps">âœ•</text>
    </view>
    
    <view class="current-step" wx:if="{{steps[currentStepIndex]}}">
      <view class="step-number-large">ç¬¬{{currentStepIndex + 1}}æ­¥</view>
      <image class="step-image-large" src="{{getImageUrl(steps[currentStepIndex].image)}}" mode="aspectFill" wx:if="{{steps[currentStepIndex].image}}" bindtap="onPreviewImage" data-url="{{getImageUrl(steps[currentStepIndex].image)}}"></image>
      <text class="step-description-large">{{steps[currentStepIndex].description}}</text>
      <view class="step-meta-large" wx:if="{{steps[currentStepIndex].duration || steps[currentStepIndex].temperature}}">
        <text class="step-duration" wx:if="{{steps[currentStepIndex].duration}}">â± {{steps[currentStepIndex].duration}}åˆ†é’Ÿ</text>
        <text class="step-temperature" wx:if="{{steps[currentStepIndex].temperature}}">ğŸŒ¡ {{steps[currentStepIndex].temperature}}Â°C</text>
      </view>
    </view>
    
    <view class="steps-navigation">
      <button class="nav-btn" bindtap="onPrevStep" disabled="{{currentStepIndex === 0}}">ä¸Šä¸€æ­¥</button>
      <button class="nav-btn primary" bindtap="onNextStep" disabled="{{currentStepIndex === steps.length - 1}}">
        {{currentStepIndex === steps.length - 1 ? 'å®Œæˆ' : 'ä¸‹ä¸€æ­¥'}}
      </button>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading" wx:if="{{loading}}">
  <text>åŠ è½½ä¸­...</text>
</view>

<!-- ç©ºçŠ¶æ€ -->
<view class="empty" wx:if="{{!loading && !dish}}">
  <text class="empty-icon">ğŸ½ï¸</text>
  <text class="empty-text">èœå“ä¸å­˜åœ¨</text>
</view>